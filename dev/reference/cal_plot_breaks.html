<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Probability calibration plots via binning — cal_plot_breaks • probably</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Probability calibration plots via binning — cal_plot_breaks"><meta name="description" content="A plot is created to assess whether the observed rate of the event is about
the same as the predicted probability of the event from some model.
A sequence of even, mutually exclusive bins are created from zero to one.
For each bin, the data whose predicted probability falls within the range
of the bin is used to calculate the observed event rate (along with confidence
intervals for the event rate).
If the predictions are well calibrated, the fitted curve should align with
the diagonal line."><meta property="og:description" content="A plot is created to assess whether the observed rate of the event is about
the same as the predicted probability of the event from some model.
A sequence of even, mutually exclusive bins are created from zero to one.
For each bin, the data whose predicted probability falls within the range
of the bin is used to calculate the observed event rate (along with confidence
intervals for the event rate).
If the predictions are well calibrated, the fitted curve should align with
the diagonal line."><meta property="og:image" content="https://probably.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="probably.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">probably</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.3.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/equivocal-zones.html">Equivocal zones</a></li>
    <li><a class="dropdown-item" href="../articles/where-to-use.html">Where does probably fit in?</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/probably/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Probability calibration plots via binning</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/probably/blob/main/R/cal-plot-breaks.R" class="external-link"><code>R/cal-plot-breaks.R</code></a></small>
      <div class="d-none name"><code>cal_plot_breaks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A plot is created to assess whether the observed rate of the event is about
the same as the predicted probability of the event from some model.</p>
<p>A sequence of even, mutually exclusive bins are created from zero to one.
For each bin, the data whose predicted probability falls within the range
of the bin is used to calculate the observed event rate (along with confidence
intervals for the event rate).
If the predictions are well calibrated, the fitted curve should align with
the diagonal line.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cal_plot_breaks</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  truth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimate <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">".pred"</span><span class="op">)</span>,</span>
<span>  num_breaks <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  include_ribbon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_rug <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  event_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"first"</span>, <span class="st">"second"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">cal_plot_breaks</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  truth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimate <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">".pred"</span><span class="op">)</span>,</span>
<span>  num_breaks <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  include_ribbon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_rug <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  event_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"first"</span>, <span class="st">"second"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .by <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'tune_results'</span></span>
<span><span class="fu">cal_plot_breaks</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  truth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimate <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">".pred"</span><span class="op">)</span>,</span>
<span>  num_breaks <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  include_ribbon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_rug <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  event_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"first"</span>, <span class="st">"second"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'grouped_df'</span></span>
<span><span class="fu">cal_plot_breaks</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  truth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  estimate <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_breaks <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  conf_level <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  include_ribbon <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_rug <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include_points <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  event_level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"first"</span>, <span class="st">"second"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>An ungrouped data frame object containing predictions and
probability columns.</p></dd>


<dt id="arg-truth">truth<a class="anchor" aria-label="anchor" href="#arg-truth"></a></dt>
<dd><p>The column identifier for the true class results
(that is a factor). This should be an unquoted column name.</p></dd>


<dt id="arg-estimate">estimate<a class="anchor" aria-label="anchor" href="#arg-estimate"></a></dt>
<dd><p>A vector of column identifiers, or one of <code>dplyr</code> selector
functions to choose which variables contains the class probabilities. It
defaults to the prefix used by tidymodels (<code>.pred_</code>). The order of the
identifiers will be considered the same as the order of the levels of the
<code>truth</code> variable.</p></dd>


<dt id="arg-num-breaks">num_breaks<a class="anchor" aria-label="anchor" href="#arg-num-breaks"></a></dt>
<dd><p>The number of segments to group the probabilities. It
defaults to 10.</p></dd>


<dt id="arg-conf-level">conf_level<a class="anchor" aria-label="anchor" href="#arg-conf-level"></a></dt>
<dd><p>Confidence level to use in the visualization. It defaults
to 0.9.</p></dd>


<dt id="arg-include-ribbon">include_ribbon<a class="anchor" aria-label="anchor" href="#arg-include-ribbon"></a></dt>
<dd><p>Flag that indicates if the ribbon layer is to be
included. It defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-include-rug">include_rug<a class="anchor" aria-label="anchor" href="#arg-include-rug"></a></dt>
<dd><p>Flag that indicates if the Rug layer is to be included.
It defaults to <code>TRUE</code>. In the plot, the top side shows the frequency the
event occurring, and the bottom the frequency of the event not occurring.</p></dd>


<dt id="arg-include-points">include_points<a class="anchor" aria-label="anchor" href="#arg-include-points"></a></dt>
<dd><p>Flag that indicates if the point layer is to be included.</p></dd>


<dt id="arg-event-level">event_level<a class="anchor" aria-label="anchor" href="#arg-event-level"></a></dt>
<dd><p>single string. Either "first" or "second" to specify which
level of truth to consider as the "event". Defaults to "auto", which allows
the function decide which one to use based on the type of model (binary,
multi-class or linear)</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the <code>tune_results</code> object.</p></dd>


<dt id="arg--by">.by<a class="anchor" aria-label="anchor" href="#arg--by"></a></dt>
<dd><p>The column identifier for the grouping variable. This should be
a single unquoted column name that selects a qualitative variable for
grouping. Default to <code>NULL</code>. When <code>.by = NULL</code> no grouping will take place.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A ggplot object.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="https://www.tidymodels.org/learn/models/calibration/" class="external-link">https://www.tidymodels.org/learn/models/calibration/</a>,
<code><a href="cal_plot_windowed.html">cal_plot_windowed()</a></code>, <code><a href="cal_plot_logistic.html">cal_plot_logistic()</a></code></p>
<p><code><a href="cal_plot_logistic.html">cal_plot_logistic()</a></code>, <code><a href="cal_plot_windowed.html">cal_plot_windowed()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">cal_plot_breaks</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">segment_logistic</span>,</span></span>
<span class="r-in"><span>  <span class="va">Class</span>,</span></span>
<span class="r-in"><span>  <span class="va">.pred_good</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cal_plot_breaks-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="cal_plot_logistic.html">cal_plot_logistic</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">segment_logistic</span>,</span></span>
<span class="r-in"><span>  <span class="va">Class</span>,</span></span>
<span class="r-in"><span>  <span class="va">.pred_good</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cal_plot_breaks-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="cal_plot_windowed.html">cal_plot_windowed</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">segment_logistic</span>,</span></span>
<span class="r-in"><span>  <span class="va">Class</span>,</span></span>
<span class="r-in"><span>  <span class="va">.pred_good</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cal_plot_breaks-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The functions support dplyr groups</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.pred_good</span>, <span class="va">segment_logistic</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">segment_logistic</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gl</span> <span class="op">&lt;-</span> <span class="va">segment_logistic</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.pred_good <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">preds</span>, source <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">segment_logistic</span>, source <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span>, <span class="va">gl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="cal_plot_logistic.html">cal_plot_logistic</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_good</span>, .by <span class="op">=</span> <span class="va">source</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cal_plot_breaks-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The grouping can be faceted in ggplot2</span></span></span>
<span class="r-in"><span><span class="va">combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="cal_plot_logistic.html">cal_plot_logistic</a></span><span class="op">(</span><span class="va">Class</span>, <span class="va">.pred_good</span>, .by <span class="op">=</span> <span class="va">source</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">source</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="cal_plot_breaks-5.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, Edgar Ruiz, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

  </div></footer></body></html>

